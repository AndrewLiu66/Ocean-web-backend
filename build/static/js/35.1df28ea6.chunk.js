(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[35,116],{1031:function(e,a,t){"use strict";t.r(a),t.d(a,"fetchFeatureService",(function(){return p})),t.d(a,"fromUrl",(function(){return u}));var r=t(166),n=t(145),l=t(134),i=t(167),o=t(325),s=t(430);async function u(e){var a;const r=null===(a=e.properties)||void 0===a?void 0:a.customParameters,i=await async function(e,a){let t=Object(o.f)(e);if(Object(l.j)(t)&&(t=await d(e,a)),Object(l.j)(t))throw new n.a("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:e});const{serverType:r,sublayer:i}=t;let u;const c={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"};switch(r){case"MapServer":u=null!=i?"FeatureLayer":async function(e,a){return(await b(e,{customParameters:a})).tileInfo}(e,a).then((e=>e?"TileLayer":"MapImageLayer"));break;case"ImageServer":u=b(e,{customParameters:a}).then((e=>{const a=e.tileInfo&&e.tileInfo.format;return e.tileInfo?"LERC"!==(null===a||void 0===a?void 0:a.toUpperCase())||e.cacheType&&"elevation"!==e.cacheType.toLowerCase()?"ImageryTileLayer":"ElevationLayer":"ImageryLayer"}));break;case"SceneServer":u=b(t.url.path,{customParameters:a}).then((e=>{if(e){if("Voxel"===(null===e||void 0===e?void 0:e.layerType))return"VoxelLayer";if(null!==e&&void 0!==e&&e.layers&&Array.isArray(e.layers)&&e.layers.length>0){var a;const t={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"},r=null===(a=e.layers[0])||void 0===a?void 0:a.layerType;if(null!=t[r])return t[r]}}return"SceneLayer"}));break;default:u=c[r]}const y={FeatureLayer:!0,SceneLayer:!0},f="FeatureServer"===r,m={parsedUrl:t,Constructor:null,layerOrTableId:f?i:null,sublayerIds:null,tableIds:null},w=await u;if(y[w]&&null==i){var v,h;const t=await async function(e,a,t){var r,n;let l,i=!1;if("FeatureServer"===a){const a=await p(e,{customParameters:t});i=!!a.layersJSON,l=a.layersJSON||a.serviceJSON}else l=await b(e,{customParameters:t});const o=null===(r=l)||void 0===r?void 0:r.layers,s=null===(n=l)||void 0===n?void 0:n.tables;return{layerIds:(null===o||void 0===o?void 0:o.map((e=>e.id)).reverse())||[],tableIds:(null===s||void 0===s?void 0:s.map((e=>e.id)).reverse())||[],layerInfos:i?o:[],tableInfos:i?s:[]}}(e,r,a);f&&(m.sublayerInfos=t.layerInfos,m.tableInfos=t.tableInfos),1!==t.layerIds.length+t.tableIds.length?(m.sublayerIds=t.layerIds,m.tableIds=t.tableIds):f&&(m.layerOrTableId=null!==(v=t.layerIds[0])&&void 0!==v?v:t.tableIds[0],m.sourceJSON=null!==(h=t.layerInfos[0])&&void 0!==h?h:t.tableInfos[0])}return m.Constructor=await async function(e){return(0,s.a[e])()}(w),m}(e.url,r),u={...e.properties,url:e.url};if(!i.sublayerIds)return null!=i.layerOrTableId&&(u.layerId=i.layerOrTableId,u.sourceJSON=i.sourceJSON),new i.Constructor(u);const y=new(0,(await t.e(38).then(t.bind(null,540))).default)({title:i.parsedUrl.title});return function(e,a,t){function r(e,r){const n={...t,layerId:e,sublayerTitleMode:"service-name"};return Object(l.k)(r)&&(n.sourceJSON=r),new a.Constructor(n)}a.sublayerIds.forEach((t=>{const n=r(t,c(a.sublayerInfos,t));e.add(n)})),a.tableIds.forEach((t=>{const n=r(t,c(a.tableInfos,t));e.tables.add(n)}))}(y,i,u),y}function c(e,a){return e?e.find((e=>e.id===a)):null}async function d(e,a){var t;const r=await b(e,{customParameters:a});let n=null,s=null;const u=r.type;if("Feature Layer"===u||"Table"===u?(n="FeatureServer",s=r.id):"indexedVector"===u?n="VectorTileServer":r.hasOwnProperty("mapName")?n="MapServer":r.hasOwnProperty("bandCount")&&r.hasOwnProperty("pixelSizeX")?n="ImageServer":r.hasOwnProperty("maxRecordCount")&&r.hasOwnProperty("allowGeometryUpdates")?n="FeatureServer":r.hasOwnProperty("streamUrls")?n="StreamServer":y(r)?(n="SceneServer",s=r.id):r.hasOwnProperty("layers")&&y(null===(t=r.layers)||void 0===t?void 0:t[0])&&(n="SceneServer"),!n)return null;const c=null!=s?Object(o.g)(e):null;return{title:Object(l.k)(c)&&r.name||Object(i.m)(e),serverType:n,sublayer:s,url:{path:Object(l.k)(c)?c.serviceUrl:Object(i.M)(e).path}}}function y(e){return(null===e||void 0===e?void 0:e.hasOwnProperty("store"))&&e.hasOwnProperty("id")&&"number"==typeof e.id}function f(e){return!e.type||"Feature Layer"===e.type}async function p(e,a){var t,r;let n=await b(e,a);n=n||{},n.layers=(null===(t=n.layers)||void 0===t?void 0:t.filter(f))||[];const l={serviceJSON:n};if(n.currentVersion<10.5)return l;const i=await b(e+"/layers",a);return l.layersJSON={layers:(null===i||void 0===i||null===(r=i.layers)||void 0===r?void 0:r.filter(f))||[],tables:(null===i||void 0===i?void 0:i.tables)||[]},l}async function b(e,a){return(await Object(r.default)(e,{responseType:"json",query:{f:"json",...null===a||void 0===a?void 0:a.customParameters,token:null===a||void 0===a?void 0:a.apiKey}})).data}},1307:function(e,a,t){"use strict";t.r(a),t.d(a,"save",(function(){return F})),t.d(a,"saveAll",(function(){return M})),t.d(a,"saveAs",(function(){return C}));var r=t(141),n=t(145),l=t(143),i=t(134),o=t(148),s=t(529),u=t(381),c=t(1031),d=t(325),y=t(840),f=t(240),p=t(399),b=t(482),m=t(609);const w=l.a.getLogger("esri.layers.FeatureLayer"),v="Feature Service";function h(e,a){return"Layer (title: ".concat(e.title,", id: ").concat(e.id,") of type '").concat(e.declaredClass,"' ").concat(a)}function O(e,a){if(a.type!==v)throw new n.a("feature-layer:portal-item-wrong-type",h(e,'should have portal item of type "'.concat(v,'"')))}async function S(e){if(await e.load(),Object(y.a)(e))throw new n.a("feature-layer:save",h(e,"using an in-memory source cannot be saved to a portal item"))}async function I(e,a,t){"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();const r=e.write({},a);return function(e,a){let t=e.messages.filter((e=>{let{type:a}=e;return"error"===a})).map((e=>{let{name:a,message:t,details:r}=e;return new n.a(a,t,r)}));if(null!==a&&void 0!==a&&a.ignoreUnsupported&&(t=t.filter((e=>{let{name:a}=e;return"layer:unsupported"!==a&&"symbol:unsupported"!==a&&"symbol-layer:unsupported"!==a&&"property:unsupported"!==a&&"url:unsupported"!==a}))),t.length>0)throw new n.a("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:t})}(a,t),r}function L(e){const{layer:a,layerJSON:t}=e;return a.isTable?{layers:[],tables:[t]}:{layers:[t],tables:[]}}function j(e){Object(m.b)(e,m.a.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,a,t)=>t.indexOf(e)===a)))}async function g(e,a){return/\/\d+\/?$/.test(e.url)?L(a[0]):async function(e,a){const{layer:{url:t,customParameters:r,apiKey:n}}=a[0];let l=await e.fetchData("json");l&&null!=l.layers&&null!=l.tables||(l=await async function(e,a,t){var r,n;e||(e={}),(r=e).layers||(r.layers=[]),(n=e).tables||(n.tables=[]);const{url:l,customParameters:s,apiKey:d}=a,{serviceJSON:y,layersJSON:f}=await Object(c.fetchFeatureService)(l,{customParameters:s,apiKey:d}),p=P(e.layers,y.layers,t),b=P(e.tables,y.tables,t);e.layers=p.itemResources,e.tables=b.itemResources;const m=[...p.added,...b.added],w=f?[...f.layers,...f.tables]:[];return await async function(e,a,t,r){const n=a.map((e=>{let{id:a}=e;return new u.default({url:t,layerId:a,sourceJSON:r.find((e=>{let{id:t}=e;return t===a}))})}));await Object(o.g)(n.map((e=>e.load()))),n.forEach((a=>{const{layerId:t,loaded:r,defaultPopupTemplate:n}=a;r&&!Object(i.j)(n)&&T(a,{id:t,popupInfo:n.toJSON()},e)}))}(e,m,l,w),e}(l,{url:t,customParameters:r,apiKey:n},a.map((e=>e.layer.layerId))));for(const i of a)T(i.layer,i.layerJSON,l);return l}(e,a)}function P(e,a,t){const n=Object(r.c)(e,a,((e,a)=>e.id===a.id));e=e.filter((e=>!n.removed.some((a=>a.id===e.id))));const l=n.added.map((e=>{let{id:a}=e;return{id:a}}));return l.forEach((a=>{let{id:t}=a;e.push({id:t})})),{itemResources:e,added:l.filter((e=>{let{id:a}=e;return!t.includes(a)}))}}function T(e,a,t){e.isTable?J(t.tables,a):J(t.layers,a)}function J(e,a){const t=e.findIndex((e=>{let{id:t}=e;return t===a.id}));-1===t?e.push(a):e[t]=a}function N(e){const{portalItem:a}=e;return Object(y.b)(e)&&!e.dynamicDataSource&&!(null===a||void 0===a||!a.loaded)&&a.type===v}const F=Object(o.f)((async function(e,a){await S(e),function(e){const a=e.portalItem;if(!a)throw w.error("save: requires the portalItem property to be set"),new n.a("feature-layer:portal-item-not-set",h(e,"requires the portalItem property to be set"));if(!a.loaded)throw new n.a("feature-layer:portal-item-not-loaded",h(e,"cannot be saved to a portal item that does not exist or is inaccessible"));O(e,a)}(e);const t=e.portalItem,r=Object(b.b)(t),l=await I(e,r,a),i=await g(t,[{layer:e,layerJSON:l}]);return j(t),await t.update({data:i}),Object(s.a)(r),t}));const M=Object(o.f)((async(e,a)=>{await async function(e){if(null===e||void 0===e||!e.length)throw new n.a("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");await Promise.all(e.map((e=>e.load())));for(const r of e)if(!N(r))throw new n.a("feature-layer-utils-saveall:invalid-parameters","'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ".concat(h(r,"does not conform")),{layer:r});const a=e.map((e=>e.portalItem.id));if(new Set(a).size>1)throw new n.a("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");const t=e.map((e=>e.layerId));if(new Set(t).size!==t.length)throw new n.a("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service")}(e);const t=e[0].portalItem,r=Object(b.b)(t),l=await Promise.all(e.map((e=>I(e,r,a)))),i=await g(t,e.map(((e,a)=>({layer:e,layerJSON:l[a]}))));return j(t),await t.update({data:i}),await Promise.all(e.slice(1).map((e=>e.portalItem.reload()))),Object(s.a)(r),t.clone()})),C=Object(o.f)((async function(e,a,t){await S(e);const r=function(e,a){var t,r,n,l;let i=p.default.from(a);return i.id&&(i=i.clone(),i.id=null),null!==(t=(n=i).type)&&void 0!==t||(n.type=v),null!==(r=(l=i).portal)&&void 0!==r||(l.portal=f.a.getDefault()),O(e,i),i}(e,a),n=Object(b.b)(r),l=L({layer:e,layerJSON:await I(e,n,t)});return await async function(e,a){const{url:t,layerId:r,title:n,fullExtent:l,isTable:o}=e,s=Object(d.f)(t),u=Object(i.k)(s)&&"FeatureServer"===s.serverType;a.url=u?t:"".concat(t,"/").concat(r),a.title||(a.title=n),a.extent=null,!o&&Object(i.k)(l)&&(a.extent=await Object(m.c)(l)),Object(m.e)(a,m.a.METADATA),Object(m.e)(a,m.a.MULTI_LAYER),Object(m.b)(a,m.a.SINGLE_LAYER),o&&Object(m.b)(a,m.a.TABLE),j(a)}(e,r),await async function(e,a,t){const r=e.portal;await r._signIn(),await r.user.addItem({item:e,data:a,folder:null===t||void 0===t?void 0:t.folder})}(r,l,t),e.portalItem=r,Object(s.a)(n),r}))},430:function(e,a,t){"use strict";t.d(a,"a",(function(){return r}));const r={BingMapsLayer:async()=>(await t.e(172).then(t.bind(null,669))).default,BuildingSceneLayer:async()=>(await Promise.all([t.e(29),t.e(173)]).then(t.bind(null,648))).default,CSVLayer:async()=>(await t.e(98).then(t.bind(null,670))).default,ElevationLayer:async()=>(await t.e(33).then(t.bind(null,660))).default,FeatureLayer:async()=>(await Promise.resolve().then(t.bind(null,381))).default,GroupLayer:async()=>(await t.e(38).then(t.bind(null,540))).default,GeoRSSLayer:async()=>(await t.e(174).then(t.bind(null,638))).default,GeoJSONLayer:async()=>(await t.e(99).then(t.bind(null,671))).default,ImageryLayer:async()=>(await Promise.all([t.e(3),t.e(14),t.e(25),t.e(100)]).then(t.bind(null,646))).default,ImageryTileLayer:async()=>(await Promise.all([t.e(3),t.e(14),t.e(25),t.e(32),t.e(83)]).then(t.bind(null,649))).default,IntegratedMeshLayer:async()=>(await t.e(71).then(t.bind(null,661))).default,KMLLayer:async()=>(await t.e(112).then(t.bind(null,672))).default,LineOfSightLayer:async()=>(await t.e(107).then(t.bind(null,652))).default,MapImageLayer:async()=>(await Promise.all([t.e(34),t.e(81)]).then(t.bind(null,639))).default,MapNotesLayer:async()=>(await t.e(113).then(t.bind(null,640))).default,OGCFeatureLayer:async()=>(await t.e(76).then(t.bind(null,673))).default,OpenStreetMapLayer:async()=>(await t.e(101).then(t.bind(null,641))).default,PointCloudLayer:async()=>(await t.e(70).then(t.bind(null,651))).default,RouteLayer:async()=>(await t.e(62).then(t.bind(null,647))).default,SceneLayer:async()=>(await Promise.all([t.e(29),t.e(108)]).then(t.bind(null,655))).default,StreamLayer:async()=>(await t.e(175).then(t.bind(null,674))).default,TileLayer:async()=>(await Promise.all([t.e(34),t.e(84)]).then(t.bind(null,642))).default,UnknownLayer:async()=>(await t.e(176).then(t.bind(null,643))).default,UnsupportedLayer:async()=>(await t.e(177).then(t.bind(null,644))).default,VectorTileLayer:async()=>(await Promise.all([t.e(28),t.e(66)]).then(t.bind(null,650))).default,VoxelLayer:async()=>(await t.e(85).then(t.bind(null,645))).default,WebTileLayer:async()=>(await t.e(114).then(t.bind(null,488))).default,WFSLayer:async()=>(await t.e(73).then(t.bind(null,675))).default,WMSLayer:async()=>(await t.e(82).then(t.bind(null,662))).default,WMTSLayer:async()=>(await t.e(77).then(t.bind(null,653))).default}},482:function(e,a,t){"use strict";t.d(a,"a",(function(){return l})),t.d(a,"b",(function(){return i}));var r=t(167),n=t(240);function l(e){return{origin:"portal-item",url:Object(r.M)(e.itemUrl),portal:e.portal||n.a.getDefault(),portalItem:e,readResourcePaths:[]}}function i(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?Object(r.M)(e.itemUrl):null,portal:e.portal||n.a.getDefault(),portalItem:e}}}}]);