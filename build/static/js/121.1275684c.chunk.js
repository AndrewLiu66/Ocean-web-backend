(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[121],{1324:function(e,t,n){"use strict";n.r(t),n.d(t,"registerFunctions",(function(){return T}));var a=n(612),r=n(397),i=n(502),o=n(1034),s=n(1215),l=n(602),c=n(526),u=n(307),f=n(1036),d=n(879),m=n(881),b=n(1038),p=n(883),y=n(1039),h=n(882),O=n(356),g=n(508),w=n(853),j=n(148),F=n(435),I=n(381),E=n(338);async function D(e,t,n){const a=e.getVariables();if(a.length>0){const r=[];for(let e=0;e<a.length;e++){const i={name:a[e]};r.push(await t.evaluateIdentifier(n,i))}const i={};for(let e=0;e<a.length;e++)i[a[e]]=r[e];return e.parameters=i,e}return e}function N(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(const a in e)if(a.toLowerCase()===t.toLowerCase())return e[a];return n}function A(e){if(null===e)return null;const t={type:N(e,"type",""),name:N(e,"name","")};if("range"===t.type)t.range=N(e,"range",[]);else{t.codedValues=[];for(const n of N(e,"codedValues",[]))t.codedValues.push({name:N(n,"name",""),code:N(n,"code",null)})}return t}function S(e){if(null===e)return null;const t={},n=N(e,"wkt",null);null!==n&&(t.wkt=n);const a=N(e,"wkid",null);return null!==a&&(t.wkid=a),t}function x(e){if(null===e)return null;const t={hasZ:N(e,"hasz",!1),hasM:N(e,"hasm",!1)},n=N(e,"spatialreference",null);n&&(t.spatialReference=S(n));const a=N(e,"x",null);if(null!==a)return t.x=a,t.y=N(e,"y",null),t;const r=N(e,"rings",null);if(null!==r)return t.rings=r,t;const i=N(e,"paths",null);if(null!==i)return t.paths=i,t;const o=N(e,"points",null);if(null!==o)return t.points=o,t;for(const s of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const n=N(e,s,null);null!==n&&(t[s]=n)}return t}function T(e){"async"===e.mode&&(e.functions.getuser=function(t,n){return e.standardFunctionAsync(t,n,(async(e,n,i)=>{Object(u.R)(i,1,2);let o=Object(u.d)(i[1],""),l=!0===o;if(o=!0===o||!1===o?"":Object(u.J)(o),i[0]instanceof a.a){let e=null;t.services&&t.services.portal&&(e=t.services.portal),e=Object(s.getPortal)(i[0],e);const n=await Object(s.lookupUser)(e,o,l);if(n){const e=JSON.parse(JSON.stringify(n));for(const t of["lastLogin","created","modified"])void 0!==e[t]&&null!==e[t]&&(e[t]=new Date(e[t]));return r.a.convertObjectToArcadeDictionary(e)}return null}let c=null;if(Object(u.ab)(i[0])&&(c=i[0]),c){if(l=!1,o)return null;await c.load();const e=await c.getOwningSystemUrl();if(!e){if(!o){const e=await c.getIdentityUser();return e?r.a.convertObjectToArcadeDictionary({username:e}):null}return null}let n=null;t.services&&t.services.portal&&(n=t.services.portal),n=Object(s.getPortal)(new a.a(e),n);const i=await Object(s.lookupUser)(n,o,l);if(i){const e=JSON.parse(JSON.stringify(i));for(const t of["lastLogin","created","modified"])void 0!==e[t]&&null!==e[t]&&(e[t]=new Date(e[t]));return r.a.convertObjectToArcadeDictionary(e)}return null}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getuser",min:"1",max:"2"}),e.functions.featuresetbyid=function(t,n){return e.standardFunctionAsync(t,n,((e,t,n)=>{if(Object(u.R)(n,2,4),n[0]instanceof o.a){const e=Object(u.J)(n[1]);let t=Object(u.d)(n[2],null);const a=Object(u.I)(Object(u.d)(n[3],!0));if(null===t&&(t=["*"]),!1===Object(u.N)(t))throw new Error("Invalid Parameter");return n[0].featureSetById(e,a,t)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),e.functions.getfeatureset=function(t,n){return e.standardFunctionAsync(t,n,((e,n,a)=>{if(Object(u.R)(a,1,2),Object(u.U)(a[0])){let e=Object(u.d)(a[1],"datasource");return null===e&&(e="datasource"),e=Object(u.J)(e).toLowerCase(),Object(s.convertToFeatureSet)(a[0].fullSchema(),e,t.lrucache,t.interceptor,t.spatialReference)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getfeatureset",min:"1",max:"2"}),e.functions.featuresetbyportalitem=function(t,n){return e.standardFunctionAsync(t,n,((e,n,r)=>{if(Object(u.R)(r,2,5),null===r[0])throw new Error("Portal is required");if(r[0]instanceof a.a){const e=Object(u.J)(r[1]),n=Object(u.J)(r[2]);let a=Object(u.d)(r[3],null);const i=Object(u.I)(Object(u.d)(r[4],!0));if(null===a&&(a=["*"]),!1===Object(u.N)(a))throw new Error("Invalid Parameter");let o=null;return t.services&&t.services.portal&&(o=t.services.portal),o=Object(s.getPortal)(r[0],o),Object(s.constructFeatureSetFromPortalItem)(e,n,t.spatialReference,a,i,o,t.lrucache,t.interceptor)}if(!1===Object(u.D)(r[0]))throw new Error("Portal is required");const i=Object(u.J)(r[0]),o=Object(u.J)(r[1]);let l=Object(u.d)(r[2],null);const c=Object(u.I)(Object(u.d)(r[3],!0));if(null===l&&(l=["*"]),!1===Object(u.N)(l))throw new Error("Invalid Parameter");if(t.services&&t.services.portal)return Object(s.constructFeatureSetFromPortalItem)(i,o,t.spatialReference,l,c,t.services.portal,t.lrucache,t.interceptor);throw new Error("Portal is required")}))},e.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),e.functions.featuresetbyname=function(t,n){return e.standardFunctionAsync(t,n,((e,t,n)=>{if(Object(u.R)(n,2,4),n[0]instanceof o.a){const e=Object(u.J)(n[1]);let t=Object(u.d)(n[2],null);const a=Object(u.I)(Object(u.d)(n[3],!0));if(null===t&&(t=["*"]),!1===Object(u.N)(t))throw new Error("Invalid Parameter");return n[0].featureSetByName(e,a,t)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),e.functions.featureset=function(t,n){return e.standardFunction(t,n,((e,n,a)=>{Object(u.R)(a,1,1);let i=a[0];const o={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(Object(u.D)(i))i=JSON.parse(i),void 0!==i.layerDefinition?(o.layerDefinition=i.layerDefinition,o.featureSet=i.featureSet,i.layerDefinition.spatialReference&&(o.layerDefinition.spatialReference=i.layerDefinition.spatialReference)):(o.featureSet.features=i.features,o.featureSet.geometryType=i.geometryType,o.layerDefinition.geometryType=o.featureSet.geometryType,o.layerDefinition.objectIdField=i.objectIdFieldName,o.layerDefinition.typeIdField=i.typeIdFieldName,o.layerDefinition.globalIdField=i.globalIdFieldName,o.layerDefinition.fields=i.fields,i.spatialReference&&(o.layerDefinition.spatialReference=i.spatialReference));else{if(!(a[0]instanceof r.a))throw new Error("Invalid Parameter");{i=JSON.parse(a[0].castToText());const e=N(i,"layerdefinition");if(null!==e){o.layerDefinition.geometryType=N(e,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.globalIdField=N(e,"globalidfield",""),o.layerDefinition.objectIdField=N(e,"objectidfield",""),o.layerDefinition.typeIdField=N(e,"typeidfield","");const t=N(e,"spatialreference",null);t&&(o.layerDefinition.spatialReference=S(t));for(const a of N(e,"fields",[])){const e={name:N(a,"name",""),alias:N(a,"alias",""),type:N(a,"type",""),nullable:N(a,"nullable",!0),editable:N(a,"editable",!0),length:N(a,"length",null),domain:A(N(a,"domain"))};o.layerDefinition.fields.push(e)}const n=N(i,"featureset",null);if(n){const e={};for(const t of o.layerDefinition.fields)e[t.name.toLowerCase()]=t.name;for(const t of N(n,"features",[])){const n={},a=N(t,"attributes",{});for(const t in a)n[e[t.toLowerCase()]]=a[t];o.featureSet.features.push({attributes:n,geometry:x(N(t,"geometry",null))})}}}else{o.layerDefinition.geometryType=N(i,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.objectIdField=N(i,"objectidfieldname",""),o.layerDefinition.typeIdField=N(i,"typeidfieldname","");const e=N(i,"spatialreference",null);e&&(o.layerDefinition.spatialReference=S(e));for(const n of N(i,"fields",[])){const e={name:N(n,"name",""),alias:N(n,"alias",""),type:N(n,"type",""),nullable:N(n,"nullable",!0),editable:N(n,"editable",!0),length:N(n,"length",null),domain:A(N(n,"domain"))};o.layerDefinition.fields.push(e)}const t={};for(const n of o.layerDefinition.fields)t[n.name.toLowerCase()]=n.name;for(const n of N(i,"features",[])){const e={},a=N(n,"attributes",{});for(const n in a)e[t[n.toLowerCase()]]=a[n];o.featureSet.features.push({attributes:e,geometry:x(N(n,"geometry",null))})}}}}if(!1===function(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e,t){for(const n of t)if(n===e)return!0;return!1}(e.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==e.layerDefinition.objectIdField&&""!==e.layerDefinition.objectIdField&&!1!==Object(u.N)(e.layerDefinition.fields)&&!1!==Object(u.N)(e.featureSet.features)}(o))throw new Error("Invalid Parameter");return y.a.create(o,t.spatialReference)}))},e.signatures.push({name:"featureset",min:"1",max:"1"}),e.functions.filter=function(t,n){return e.standardFunctionAsync(t,n,(async(n,a,r)=>{if(Object(u.R)(r,2,2),Object(u.N)(r[0])||Object(u.P)(r[0])){const n=[];let a=r[0];a instanceof c.a&&(a=a.toArray());let i=null;if(r[1]instanceof l.a)i=e.arcadeCustomFunctionHandler(r[1]);else if(r[1]instanceof u.o)i=function(){for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return r[1].fn(t,{preparsed:!0,arguments:n})};else{if(!(r[1]instanceof u.t))throw new Error("Invalid Parameter");i=function(){if(arguments.length!==r[1].paramCount)throw new Error("Invalid parameters");return r[1].fn(...arguments)}}for(const e of a){const t=i(e);Object(j.l)(t)?!0===await t&&n.push(e):!0===t&&n.push(e)}return n}if(Object(u.ab)(r[0])){const n=await r[0].load(),a=F.WhereClause.create(r[1],n.getFieldsIndex()),i=a.getVariables();if(i.length>0){const n=[];for(let a=0;a<i.length;a++){const r={name:i[a]};n.push(await e.evaluateIdentifier(t,r))}const o={};for(let e=0;e<i.length;e++)o[i[e]]=n[e];return a.parameters=o,new d.a({parentfeatureset:r[0],whereclause:a})}return new d.a({parentfeatureset:r[0],whereclause:a})}throw new Error("Filter cannot accept this parameter type")}))},e.signatures.push({name:"filter",min:"2",max:"2"}),e.functions.orderby=function(t,n){return e.standardFunctionAsync(t,n,(async(e,t,n)=>{if(Object(u.R)(n,2,2),Object(u.ab)(n[0])){const e=new h.a(n[1]);return new m.a({parentfeatureset:n[0],orderbyclause:e})}throw new Error("Order cannot accept this parameter type")}))},e.signatures.push({name:"orderby",min:"2",max:"2"}),e.functions.top=function(t,n){return e.standardFunctionAsync(t,n,(async(e,t,n)=>{if(Object(u.R)(n,2,2),Object(u.ab)(n[0]))return new b.a({parentfeatureset:n[0],topnum:n[1]});if(Object(u.N)(n[0]))return Object(u.H)(n[1])>=n[0].length?n[0].slice(0):n[0].slice(0,Object(u.H)(n[1]));if(Object(u.P)(n[0]))return Object(u.H)(n[1])>=n[0].length()?n[0].slice(0):n[0].slice(0,Object(u.H)(n[1]));throw new Error("Top cannot accept this parameter type")}))},e.signatures.push({name:"top",min:"2",max:"2"}),e.functions.first=function(t,n){return e.standardFunctionAsync(t,n,(async(e,t,n)=>{if(Object(u.R)(n,1,1),Object(u.ab)(n[0])){const t=await n[0].first(e.abortSignal);if(null!==t){const e=i.a.createFromGraphicLikeObject(t.geometry,t.attributes,n[0]);return e._underlyingGraphic=t,e}return t}return Object(u.N)(n[0])?0===n[0].length?null:n[0][0]:Object(u.P)(n[0])?0===n[0].length()?null:n[0].get(0):null}))},e.signatures.push({name:"first",min:"1",max:"1"}),e.functions.attachments=function(t,n){return e.standardFunctionAsync(t,n,(async(e,n,a)=>{Object(u.R)(a,1,2);const i={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(a.length>1)if(a[1]instanceof r.a){if(a[1].hasField("minsize")&&(i.minsize=Object(u.H)(a[1].field("minsize"))),a[1].hasField("metadata")&&(i.returnMetadata=Object(u.I)(a[1].field("metadata"))),a[1].hasField("maxsize")&&(i.maxsize=Object(u.H)(a[1].field("maxsize"))),a[1].hasField("types")){const e=Object(u.z)(a[1].field("types"),!1);e.length>0&&(i.types=e)}}else if(null!==a[1])throw new Error("Invalid Parameter");if(Object(u.U)(a[0])){let e=a[0]._layer;return e instanceof I.default&&(e=Object(s.constructFeatureSet)(e,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===e||!1===Object(u.ab)(e)?[]:(await e.load(),e.queryAttachments(a[0].field(e.objectIdField),i.minsize,i.maxsize,i.types,i.returnMetadata))}if(null===a[0])return[];throw new Error("Invalid Parameter")}))},e.signatures.push({name:"attachments",min:"1",max:"2"}),e.functions.featuresetbyrelationshipname=function(t,n){return e.standardFunctionAsync(t,n,(async(e,n,a)=>{Object(u.R)(a,2,4);const r=a[0],i=Object(u.J)(a[1]);let o=Object(u.d)(a[2],null);const l=Object(u.I)(Object(u.d)(a[3],!0));if(null===o&&(o=["*"]),!1===Object(u.N)(o))throw new Error("Invalid Parameter");if(null===a[0])return null;if(!Object(u.U)(a[0]))throw new Error("Invalid Parameter");let c=r._layer;if(c instanceof I.default&&(c=Object(s.constructFeatureSet)(c,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===c)return null;if(!1===Object(u.ab)(c))return null;c=await c.load();const f=c.relationshipMetaData().filter((e=>e.name===i));if(0===f.length)return null;if(void 0!==f[0].relationshipTableId&&null!==f[0].relationshipTableId&&f[0].relationshipTableId>-1)return Object(s.constructFeatureSetFromRelationship)(c,f[0],r.field(c.objectIdField),c.spatialReference,o,l,t.lrucache,t.interceptor);let d=c.serviceUrl();if(!d)return null;d="/"===d.charAt(d.length-1)?d+f[0].relatedTableId.toString():d+"/"+f[0].relatedTableId.toString();const m=await Object(s.constructFeatureSetFromUrl)(d,c.spatialReference,o,l,t.lrucache,t.interceptor);await m.load();let b=m.relationshipMetaData();if(b=b.filter((e=>e.id===f[0].id)),!1===r.hasField(f[0].keyField)||null===r.field(f[0].keyField)){const e=await c.getFeatureByObjectId(r.field(c.objectIdField),[f[0].keyField]);if(e){const t=F.WhereClause.create(b[0].keyField+"= @id",m.getFieldsIndex());return t.parameters={id:e.attributes[f[0].keyField]},m.filter(t)}return new p.a({parentfeatureset:m})}const y=F.WhereClause.create(b[0].keyField+"= @id",m.getFieldsIndex());return y.parameters={id:r.field(f[0].keyField)},m.filter(y)}))},e.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),e.functions.featuresetbyassociation=function(t,n){return e.standardFunctionAsync(t,n,(async(e,n,a)=>{Object(u.R)(a,2,3);const r=a[0],i=Object(u.J)(Object(u.d)(a[1],"")).toLowerCase(),o=Object(u.D)(a[2])?Object(u.J)(a[2]):null;if(null===a[0])return null;if(!Object(u.U)(a[0]))throw new Error("Invalid Parameter");let l=r._layer;if(l instanceof I.default&&(l=Object(s.constructFeatureSet)(l,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===l)return null;if(!1===Object(u.ab)(l))return null;await l.load();const c=l.serviceUrl(),d=await Object(s.constructAssociationMetaDataFeatureSetFromUrl)(c,t.spatialReference);let m=null,b=null,p=!1;if(null!==o&&""!==o&&void 0!==o){for(const e of d.terminals)e.terminalName===o&&(b=e.terminalId);null===b&&(p=!0)}const y=d.associations.getFieldsIndex(),h=y.get("TOGLOBALID").name,g=y.get("FROMGLOBALID").name,w=y.get("TOTERMINALID").name,j=y.get("FROMTERMINALID").name,D=y.get("FROMNETWORKSOURCEID").name,N=y.get("TONETWORKSOURCEID").name,A=y.get("ASSOCIATIONTYPE").name,S=y.get("ISCONTENTVISIBLE").name,x=y.get("OBJECTID").name;for(const t of l.fields)if("global-id"===t.type){m=r.field(t.name);break}let T=null,C=new f.d(new E.a({name:"percentalong",alias:"percentalong",type:"double"}),F.WhereClause.create("0",d.associations.getFieldsIndex())),R=new f.d(new E.a({name:"side",alias:"side",type:"string"}),F.WhereClause.create("''",d.associations.getFieldsIndex()));const v="globalid",L="globalId",P={};for(const t in d.lkp)P[t]=d.lkp[t].sourceId;const W=new f.e(new E.a({name:"classname",alias:"classname",type:"string"}),null,P);let M="";switch(i){case"midspan":{M="((".concat(h,"='").concat(m,"') OR ( ").concat(g,"='").concat(m,"')) AND (").concat(A," IN (5))"),W.codefield=F.WhereClause.create("CASE WHEN (".concat(h,"='").concat(m,"') THEN ").concat(D," ELSE ").concat(N," END"),d.associations.getFieldsIndex());const e=Object(O.c)(f.a.findField(d.associations.fields,g));e.name=v,e.alias=v,T=new f.d(e,F.WhereClause.create("CASE WHEN (".concat(g,"='").concat(m,"') THEN ").concat(h," ELSE ").concat(g," END"),d.associations.getFieldsIndex())),C=d.unVersion>=4?new f.c(f.a.findField(d.associations.fields,y.get("PERCENTALONG").name)):new f.d(new E.a({name:"percentalong",alias:"percentalong",type:"double"}),F.WhereClause.create("0",d.associations.getFieldsIndex()));break}case"junctionedge":{M="((".concat(h,"='").concat(m,"') OR ( ").concat(g,"='").concat(m,"')) AND (").concat(A," IN (4,6))"),W.codefield=F.WhereClause.create("CASE WHEN (".concat(h,"='").concat(m,"') THEN ").concat(D," ELSE ").concat(N," END"),d.associations.getFieldsIndex());const e=Object(O.c)(f.a.findField(d.associations.fields,g));e.name=v,e.alias=v,T=new f.d(e,F.WhereClause.create("CASE WHEN (".concat(g,"='").concat(m,"') THEN ").concat(h," ELSE ").concat(g," END"),d.associations.getFieldsIndex())),R=new f.d(new E.a({name:"side",alias:"side",type:"string"}),F.WhereClause.create("CASE WHEN (".concat(A,"=4) THEN 'from' ELSE 'to' END"),d.associations.getFieldsIndex()));break}case"connected":{let e="".concat(h,"='@T'"),t="".concat(g,"='@T'");null!==b&&(e+=" AND ".concat(w,"=@A"),t+=" AND ".concat(j,"=@A")),M="(("+e+") OR ("+t+"))",M=Object(u.n)(M,"@T",m),e=Object(u.n)(e,"@T",m),null!==b&&(e=Object(u.n)(e,"@A",b.toString()),M=Object(u.n)(M,"@A",b.toString())),W.codefield=F.WhereClause.create("CASE WHEN "+e+" THEN ".concat(D," ELSE ").concat(N," END"),d.associations.getFieldsIndex());const n=Object(O.c)(f.a.findField(d.associations.fields,g));n.name=v,n.alias=v,T=new f.d(n,F.WhereClause.create("CASE WHEN "+e+" THEN ".concat(g," ELSE ").concat(h," END"),d.associations.getFieldsIndex()));break}case"container":M="".concat(h,"='").concat(m,"' AND ").concat(A," = 2"),null!==b&&(M+=" AND ".concat(w," = ")+b.toString()),W.codefield=D,M="( "+M+" )",T=new f.b(f.a.findField(d.associations.fields,g),v,v);case"content":M="(".concat(g,"='").concat(m,"' AND ").concat(A," = 2)"),null!==b&&(M+=" AND ".concat(j," = ")+b.toString()),W.codefield=N,M="( "+M+" )",T=new f.b(f.a.findField(d.associations.fields,h),v,v);break;case"structure":M="(".concat(h,"='").concat(m,"' AND ").concat(A," = 3)"),null!==b&&(M+=" AND ".concat(w," = ")+b.toString()),W.codefield=D,M="( "+M+" )",T=new f.b(f.a.findField(d.associations.fields,g),v,L);break;case"attached":M="(".concat(g,"='").concat(m,"' AND ").concat(A," = 3)"),null!==b&&(M+=" AND ".concat(j," = ")+b.toString()),W.codefield=N,M="( "+M+" )",T=new f.b(f.a.findField(d.associations.fields,h),v,L);break;default:throw new Error("Invalid Parameter")}return p&&(M="1 <> 1"),new f.a({parentfeatureset:d.associations,adaptedFields:[new f.c(f.a.findField(d.associations.fields,x)),new f.c(f.a.findField(d.associations.fields,S)),T,R,W,C],extraFilter:M?F.WhereClause.create(M,d.associations.getFieldsIndex()):null})}))},e.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),e.functions.groupby=function(t,n){return e.standardFunctionAsync(t,n,(async(n,a,i)=>{if(Object(u.R)(i,3,3),!Object(u.ab)(i[0]))throw new Error("Illegal Value: GroupBy");const o=await i[0].load(),s=[],l=[];let c=!1,f=[];if(Object(u.D)(i[1]))f.push(i[1]);else if(i[1]instanceof r.a)f.push(i[1]);else if(Object(u.N)(i[1]))f=i[1];else{if(!Object(u.P)(i[1]))throw new Error("Illegal Value: GroupBy");f=i[1].toArray()}for(const e of f)if(Object(u.D)(e)){const t=F.WhereClause.create(Object(u.J)(e),o.getFieldsIndex()),n=!0===Object(g.c)(t)?Object(u.J)(e):"%%%%FIELDNAME";s.push({name:n,expression:t}),"%%%%FIELDNAME"===n&&(c=!0)}else{if(!(e instanceof r.a))throw new Error("Illegal Value: GroupBy");{const t=e.hasField("name")?e.field("name"):"%%%%FIELDNAME",n=e.hasField("expression")?e.field("expression"):"";if("%%%%FIELDNAME"===t&&(c=!0),!t)throw new Error("Illegal Value: GroupBy");s.push({name:t,expression:F.WhereClause.create(n||t,o.getFieldsIndex())})}}if(f=[],Object(u.D)(i[2]))f.push(i[2]);else if(Object(u.N)(i[2]))f=i[2];else if(Object(u.P)(i[2]))f=i[2].toArray();else{if(!(i[2]instanceof r.a))throw new Error("Illegal Value: GroupBy");f.push(i[2])}for(const e of f){if(!(e instanceof r.a))throw new Error("Illegal Value: GroupBy");{const t=e.hasField("name")?e.field("name"):"",n=e.hasField("statistic")?e.field("statistic"):"",a=e.hasField("expression")?e.field("expression"):"";if(!t||!n||!a)throw new Error("Illegal Value: GroupBy");l.push({name:t,statistic:n.toLowerCase(),expression:F.WhereClause.create(a,o.getFieldsIndex())})}}if(c){const e={};for(const n of o.fields)e[n.name.toLowerCase()]=1;for(const n of s)"%%%%FIELDNAME"!==n.name&&(e[n.name.toLowerCase()]=1);for(const n of l)"%%%%FIELDNAME"!==n.name&&(e[n.name.toLowerCase()]=1);let t=0;for(const n of s)if("%%%%FIELDNAME"===n.name){for(;1===e["field_"+t.toString()];)t++;e["field_"+t.toString()]=1,n.name="FIELD_"+t.toString()}}for(const r of s)await D(r.expression,e,t);for(const r of l)await D(r.expression,e,t);return i[0].groupby(s,l)}))},e.signatures.push({name:"groupby",min:"3",max:"3"}),e.functions.distinct=function(t,n){return e.standardFunctionAsync(t,n,(async(n,a,i)=>{if(Object(u.ab)(i[0])){Object(u.R)(i,2,2);const n=await i[0].load(),a=[];let o=[];if(Object(u.D)(i[1]))o.push(i[1]);else if(i[1]instanceof r.a)o.push(i[1]);else if(Object(u.N)(i[1]))o=i[1];else{if(!Object(u.P)(i[1]))throw new Error("Illegal Value: GroupBy");o=i[1].toArray()}let s=!1;for(const e of o)if(Object(u.D)(e)){const t=F.WhereClause.create(Object(u.J)(e),n.getFieldsIndex()),r=!0===Object(g.c)(t)?Object(u.J)(e):"%%%%FIELDNAME";a.push({name:r,expression:t}),"%%%%FIELDNAME"===r&&(s=!0)}else{if(!(e instanceof r.a))throw new Error("Illegal Value: GroupBy");{const t=e.hasField("name")?e.field("name"):"%%%%FIELDNAME",r=e.hasField("expression")?e.field("expression"):"";if("%%%%FIELDNAME"===t&&(s=!0),!t)throw new Error("Illegal Value: GroupBy");a.push({name:t,expression:F.WhereClause.create(r||t,n.getFieldsIndex())})}}if(s){const e={};for(const a of n.fields)e[a.name.toLowerCase()]=1;for(const n of a)"%%%%FIELDNAME"!==n.name&&(e[n.name.toLowerCase()]=1);let t=0;for(const n of a)if("%%%%FIELDNAME"===n.name){for(;1===e["field_"+t.toString()];)t++;e["field_"+t.toString()]=1,n.name="FIELD_"+t.toString()}}for(const r of a)await D(r.expression,e,t);return i[0].groupby(a,[])}return function(e,t,n,a){if(1===a.length){if(Object(u.N)(a[0]))return Object(w.a)(e,a[0],-1);if(Object(u.P)(a[0]))return Object(w.a)(e,a[0].toArray(),-1)}return Object(w.a)(e,a,-1)}("distinct",0,0,i)}))})}}}]);