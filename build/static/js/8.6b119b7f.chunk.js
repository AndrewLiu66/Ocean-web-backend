(this["webpackJsonpmatx-react-pro"]=this["webpackJsonpmatx-react-pro"]||[]).push([[8],{1022:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var s=i(135),r=i(855),n=i(165);const a={minX:0,minY:0,maxX:0,maxY:0};function o(e,t,i){(function(e){a.minX=e[0],a.minY=e[1],a.maxX=e[2],a.maxY=e[3]})(t),e.search(a,i)}class c{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new r.a(9,Object(s.a)("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach(((i,s)=>{e[t++]=s})),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter((e=>this._idByBounds.has(e)))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=Object(n.h)();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),o(this._index,e,(e=>t(this._idByBounds.get(e))))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},377:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));const s={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},530:function(e,t,i){"use strict";i.d(t,"a",(function(){return F}));var s=i(141),r=i(145),n=i(147),a=i(134),o=i(723),c=i(230),u=i(402),h=i(165),l=i(192),d=i(153),f=i(263),m=i(170),p=i(174),y=i(919),g=i(265),_=i(377),x=i(917),b=i(663),j=i(619),S=i(504),O=i(304),I=i(256),w=i(907);const R="feature-store:unsupported-query";const B=new o.b(2e6);let v=0;class F{constructor(e){this.capabilities={query:_.a},this.geometryType=e.geometryType,this.hasM=e.hasM,this.hasZ=e.hasZ,this.objectIdField=e.objectIdField,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(()=>this.clearCache())),this.timeInfo=e.timeInfo,e.cacheSpatialQueries&&(this._geometryQueryCache=new o.a(v+++"$$",B)),this.fieldsIndex=new O.a(e.fields),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}destroy(){this._frameTask=Object(a.p)(this._frameTask),this.clearCache(),Object(a.d)(this._geometryQueryCache),this._changeHandle=Object(a.p)(this._changeHandle),Object(a.d)(this.fieldsIndex)}get featureAdapter(){return this.featureStore.featureAdapter}get fullExtent(){const e=this.featureStore.fullBounds;return Object(a.j)(e)?null:{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:Object(S.b)(this.spatialReference)}}get timeExtent(){return this.timeInfo?(this._timeExtent||(this._timeExtent=Object(j.a)(this.timeInfo,this.featureStore)),this._timeExtent):null}clearCache(){var e;null!==(e=this._geometryQueryCache)&&void 0!==e&&e.clear(),this._allItems=null,this._timeExtent=null}async executeQuery(e,t){try{return(await this._executeQuery(e,{},t)).createQueryResponse()}catch(i){if(i!==S.a)throw i;return new x.a([],e,this).createQueryResponse()}}async executeQueryForCount(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;try{return(await this._executeQuery(e,{returnGeometry:!1,returnCentroid:!1,outSR:null},t)).createQueryResponseForCount()}catch(i){if(i!==S.a)throw i;return 0}}async executeQueryForExtent(e,t){const i=e.outSR;try{const s=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},t),r=s.size;if(!r)return{count:0,extent:null};Object(u.j)(Q,u.a),this.featureStore.forEachBounds(s.items,(e=>Object(u.e)(Q,e)),M);const n={xmin:Q[0],ymin:Q[1],xmax:Q[3],ymax:Q[4],spatialReference:Object(S.b)(this.spatialReference)};this.hasZ&&isFinite(Q[2])&&isFinite(Q[5])&&(n.zmin=Q[2],n.zmax=Q[5]);const a=Object(g.b)(n,s.spatialReference,i);if(a.spatialReference=Object(S.b)(i||this.spatialReference),a.xmax-a.xmin==0){const e=Object(c.c)(a.spatialReference);a.xmin-=e,a.xmax+=e}if(a.ymax-a.ymin==0){const e=Object(c.c)(a.spatialReference);a.ymin-=e,a.ymax+=e}if(this.hasZ&&null!=a.zmin&&null!=a.zmax&&a.zmax-a.zmin==0){const e=Object(c.c)(a.spatialReference);a.zmin-=e,a.zmax+=e}return{count:r,extent:a}}catch(s){if(s===S.a)return{count:0,extent:null};throw s}}async executeQueryForIds(e,t){return this.executeQueryForIdSet(e,t).then((e=>Array.from(e)))}async executeQueryForIdSet(e,t){try{const i=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},t),s=i.items,r=new Set;return await this._reschedule((()=>{for(const e of s)r.add(i.featureAdapter.getObjectId(e))}),t),r}catch(i){if(i===S.a)return new Set;throw i}}async executeQueryForSnapping(e,t){const{point:i,distance:s,types:r}=e;if(r===x.b.NONE)return{candidates:[]};const n=await this._reschedule((()=>this._checkQuerySupport(e.query)),t),o=!Object(m.d)(i.spatialReference,this.spatialReference);o&&await Object(g.a)(i.spatialReference,this.spatialReference);const c="number"==typeof s?s:s.x,u="number"==typeof s?s:s.y,h={xmin:i.x-c,xmax:i.x+c,ymin:i.y-u,ymax:i.y+u,spatialReference:i.spatialReference},l=o?Object(g.b)(h,this.spatialReference):h;if(!l)return{candidates:[]};const p=(await Object(f.a)(Object(d.a)(i),null,{signal:t}))[0],y=(await Object(f.a)(Object(d.a)(l),null,{signal:t}))[0];if(Object(a.j)(p)||Object(a.j)(y))return{candidates:[]};const _=new x.a(this._searchFeatures(this._getQueryBBoxes(y.toJSON())),n,this);await this._reschedule((()=>this._executeObjectIdsQuery(_)),t),await this._reschedule((()=>this._executeTimeQuery(_)),t),await this._reschedule((()=>this._executeAttributesQuery(_)),t);const b=p.toJSON(),j=o?Object(g.b)(b,this.spatialReference):b,S=o?Math.max(l.xmax-l.xmin,l.ymax-l.ymin)/2:s;return _.createSnappingResponse({...e,point:j,distance:S},i.spatialReference)}async executeQueryForLatestObservations(e,t){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new r.a(R,"Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});try{const i=await this._executeQuery(e,{},t);return await this._reschedule((()=>this._filterLatest(i)),t),i.createQueryResponse()}catch(i){if(i!==S.a)throw i;return new x.a([],e,this).createQueryResponse()}}async executeQueryForSummaryStatistics(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;const{field:s,normalizationField:r,valueExpression:n}=t;return(await this._getQueryEngineResultForStats(e,{field:s,normalizationField:r,valueExpression:n},i)).createSummaryStatisticsResponse(t)}async executeQueryForUniqueValues(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;const{field:s,valueExpression:r}=t;return(await this._getQueryEngineResultForStats(e,{field:s,valueExpression:r},i)).createUniqueValuesResponse(t)}async executeQueryForClassBreaks(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;const{field:s,normalizationField:r,valueExpression:n}=t;return(await this._getQueryEngineResultForStats(e,{field:s,normalizationField:r,valueExpression:n},i)).createClassBreaksResponse(t)}async executeQueryForHistogram(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;const{field:s,normalizationField:r,valueExpression:n}=t;return(await this._getQueryEngineResultForStats(e,{field:s,normalizationField:r,valueExpression:n},i)).createHistogramResponse(t)}async _schedule(e,t){return Object(a.k)(this._frameTask)?this._frameTask.schedule(e,t):e(w.c)}async _reschedule(e,t){return Object(a.k)(this._frameTask)?this._frameTask.reschedule(e,t):e(w.c)}_getAll(e){return Object(a.j)(this._allItems)&&(this._allItems=this.featureStore.toArray()),new x.a(this._allItems,e,this)}async _executeQuery(e,t,i){e=Object(n.a)(e),e=await this._schedule((()=>Object(S.d)(e,this.definitionExpression,this.spatialReference)),i),e=await this._reschedule((()=>this._checkQuerySupport(e)),i),e={...e,...t};const s=await this._reschedule((()=>this._executeSceneFilterQuery(e,i)),i),r=await this._reschedule((()=>this._executeGeometryQuery(e,s,i)),i);return await this._reschedule((()=>this._executeAggregateIdsQuery(r)),i),await this._reschedule((()=>this._executeObjectIdsQuery(r)),i),await this._reschedule((()=>this._executeTimeQuery(r)),i),await this._reschedule((()=>this._executeAttributesQuery(r)),i),r}async _executeSceneFilterQuery(e,t){if(Object(a.j)(e.sceneFilter))return null;const{outSR:i,returnGeometry:s,returnCentroid:r}=e,n=this.featureStore.featureSpatialReference,o=e.sceneFilter.geometry,c=Object(a.j)(n)||Object(m.d)(n,o.spatialReference)?o:Object(g.b)(o,n);if(!c)return null;const u=s||r,h=Object(m.l)(i)&&!Object(m.d)(this.spatialReference,i)&&u?async e=>this._project(e,i):e=>e,l=this.featureAdapter,d=this._searchFeatures(this._getQueryBBoxes(c));if("disjoint"===e.sceneFilter.spatialRelationship){if(!d.length)return null;const i=new Set;for(const e of d)i.add(l.getObjectId(e));const s=await this._reschedule((()=>this.featureStore.toArray()),t);return h(await this._reschedule((async()=>{const r=await Object(b.c)("esriSpatialRelDisjoint",c,this.geometryType,this.hasZ,this.hasM),n=await this._runSpatialFilter(s,(e=>!i.has(l.getObjectId(e))||r(l.getGeometry(e))),t);return new x.a(n,e,this)}),t))}if(!d.length)return new x.a([],e,this);if(this._canExecuteSinglePass(c,e))return h(new x.a(d,e,this));const f=await Object(b.c)("esriSpatialRelContains",c,this.geometryType,this.hasZ,this.hasM),p=await this._runSpatialFilter(d,(e=>f(l.getGeometry(e))),t);return h(new x.a(p,e,this))}async _executeGeometryQuery(e,t,i){if(Object(a.k)(t)&&0===t.items.length)return t;e=Object(a.k)(t)?t.query:e;const{geometry:r,outSR:n,spatialRel:o,returnGeometry:c,returnCentroid:u}=e,h=this.featureStore.featureSpatialReference,l=!r||Object(a.j)(h)||Object(m.d)(h,r.spatialReference)?r:Object(g.b)(r,h),d=c||u,f=Object(m.l)(n)&&!Object(m.d)(this.spatialReference,n),p=this._geometryQueryCache&&Object(a.j)(t)?f&&d?JSON.stringify({originalFilterGeometry:r,spatialRelationship:o,outSpatialReference:n}):JSON.stringify({originalFilterGeometry:r,spatialRelationship:o}):null,y=p?this._geometryQueryCache.get(p):null;if(Object(a.k)(y))return new x.a(y,e,this);const _=async e=>(f&&d&&await this._project(e,n),p&&this._geometryQueryCache.put(p,e.items,e.items.length+1),e);if(!l)return _(Object(a.k)(t)?t:this._getAll(e));const j=this.featureAdapter;let S=this._searchFeatures(this._getQueryBBoxes(r));if("esriSpatialRelDisjoint"===o){if(!S.length)return _(Object(a.k)(t)?t:this._getAll(e));const s=new Set;for(const e of S)s.add(j.getObjectId(e));const r=Object(a.k)(t)?t.items:await this._reschedule((()=>this.featureStore.toArray()),i),n=await this._reschedule((async()=>{const t=await Object(b.c)(o,l,this.geometryType,this.hasZ,this.hasM),n=await this._runSpatialFilter(r,(e=>!s.has(j.getObjectId(e))||t(j.getGeometry(e))),i);return new x.a(n,e,this)}),i);return _(n)}if(Object(a.k)(t)){const e=new s.a;S=S.filter((i=>Object(s.f)(t.items,i,t.items.length,e)>=0))}if(!S.length){const t=new x.a([],e,this);return p&&this._geometryQueryCache.put(p,t.items,1),t}if(this._canExecuteSinglePass(l,e))return _(new x.a(S,e,this));const O=await Object(b.c)(o,l,this.geometryType,this.hasZ,this.hasM),I=await this._runSpatialFilter(S,(e=>O(j.getGeometry(e))),i);return _(new x.a(I,e,this))}_executeAggregateIdsQuery(e){if(0===e.items.length||!e.query.aggregateIds||!e.query.aggregateIds.length||Object(a.j)(this.aggregateAdapter))return;const t=new Set;for(const s of e.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(s).forEach((e=>t.add(e)));const i=this.featureAdapter.getObjectId;e.items=e.items.filter((e=>t.has(i(e))))}_executeObjectIdsQuery(e){if(0===e.items.length||!e.query.objectIds||!e.query.objectIds.length)return;const t=new Set(e.query.objectIds),i=this.featureAdapter.getObjectId;e.items=e.items.filter((e=>t.has(i(e))))}_executeTimeQuery(e){if(0===e.items.length)return;const t=Object(j.b)(this.timeInfo,e.query.timeExtent,this.featureAdapter);Object(a.j)(t)||(e.items=e.items.filter(t))}_executeAttributesQuery(e){if(0===e.items.length)return;const t=Object(y.c)(e.query.where,this.fieldsIndex);if(t){if(!t.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter((e=>t.testFeature(e,this.featureAdapter)))}}async _runSpatialFilter(e,t,i){if(!t)return e;if(Object(a.j)(this._frameTask))return e.filter((e=>t(e)));let s=0;const r=new Array,n=async a=>{for(;s<e.length;){const o=e[s++];t(o)&&(r.push(o),a.madeProgress()),a.done&&await this._reschedule((e=>n(e)),i)}};return this._reschedule((e=>n(e)),i).then((()=>r))}_filterLatest(e){const{trackIdField:t,startTimeField:i,endTimeField:s}=this.timeInfo,r=s||i,n=new Map,a=this.featureAdapter.getAttribute;for(const o of e.items){const e=a(o,t),i=a(o,r),s=n.get(e);(!s||i>a(s,r))&&n.set(e,o)}e.items=Array.from(n.values())}_canExecuteSinglePass(e,t){const{spatialRel:i}=t;return Object(b.a)(e)&&("esriSpatialRelEnvelopeIntersects"===i||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===i||"esriSpatialRelContains"===i||"esriSpatialRelWithin"===i))}async _project(e,t){if(!t||Object(m.d)(this.spatialReference,t))return e;const i=this.featureAdapter,s=await Object(g.c)(e.items.map((e=>Object(S.c)(this.geometryType,this.hasZ,this.hasM,i.getGeometry(e)))),this.spatialReference,t);return e.items=s.map(((t,s)=>i.cloneWithGeometry(e.items[s],Object(p.d)(t,this.hasZ,this.hasM)))),e}_getQueryBBoxes(e){if(Object(b.a)(e)){if(Object(d.d)(e))return[Object(h.m)(e.xmin,e.ymin,e.xmax,e.ymax)];if(Object(d.g)(e))return e.rings.map((e=>Object(h.m)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))))}return[Object(l.a)(Object(h.g)(),e)]}_searchFeatures(e){for(const i of e)this.featureStore.forEachInBounds(i,(e=>E.add(e)));const t=Array.from(E.values());return E.clear(),t}async _checkStatisticsSupport(e,t){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text||e.outStatistics||e.groupByFieldsForStatistics||e.having||e.orderByFields)throw new r.a(R,"Unsupported query options",{query:e});return this._checkAttributesQuerySupport(e),Promise.all([this._checkStatisticsParamsSupport(t),Object(b.b)(e,this.geometryType,this.spatialReference),Object(g.a)(this.spatialReference,e.outSR)]).then((()=>e))}async _checkStatisticsParamsSupport(e){let t=[];if(e.valueExpression){const{arcadeUtils:i}=await Object(I.e)();t=i.extractFieldNames(e.valueExpression)}if(e.field&&t.push(e.field),e.normalizationField&&t.push(e.normalizationField),!t.length)throw new r.a(R,"params should have at least a field or valueExpression",{params:e});Object(y.e)(this.fieldsIndex,t,"params contains missing fields")}async _checkQuerySupport(e){if(e.distance<0||null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new r.a(R,"Unsupported query options",{query:e});return this._checkAttributesQuerySupport(e),this._checkStatisticsQuerySupport(e),Promise.all([Object(b.b)(e,this.geometryType,this.spatialReference),Object(g.a)(this.spatialReference,e.outSR)]).then((()=>e))}_checkAttributesQuerySupport(e){const{outFields:t,orderByFields:i,returnDistinctValues:s,outStatistics:n}=e,a=n?n.map((e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase())).filter(Boolean):[];if(i&&i.length>0){const e=" asc",t=" desc",s=i.map((i=>{const s=i.toLowerCase();return s.includes(e)?s.split(e)[0]:s.includes(t)?s.split(t)[0]:i})).filter((e=>!a.includes(e)));Object(y.e)(this.fieldsIndex,s,"orderByFields contains missing fields")}if(t&&t.length>0)Object(y.e)(this.fieldsIndex,t,"outFields contains missing fields");else if(s)throw new r.a(R,"outFields should be specified for returnDistinctValues",{query:e});Object(y.g)(this.fieldsIndex,e.where)}_checkStatisticsQuerySupport(e){const{outStatistics:t,groupByFieldsForStatistics:i,having:s}=e,n=i&&i.length,a=t&&t.length;if(s){if(!n||!a)throw new r.a(R,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});Object(y.f)(this.fieldsIndex,s,t)}if(a){if(!function(e){return e.every((e=>"exceedslimit"!==e.statisticType))}(t))return;const s=t.map((e=>e.onStatisticField)).filter(Boolean);Object(y.e)(this.fieldsIndex,s,"onStatisticFields contains missing fields"),n&&Object(y.e)(this.fieldsIndex,i,"groupByFieldsForStatistics contains missing fields");for(const i of t){const{onStatisticField:t,statisticType:s}=i;if("percentile_disc"!==s&&"percentile_cont"!==s||!("statisticParameters"in i)){if("count"!==s&&t&&Object(y.d)(t,this.fieldsIndex))throw new r.a(R,"outStatistics contains non-numeric fields",{definition:i,query:e})}else{const{statisticParameters:t}=i;if(!t)throw new r.a(R,"statisticParamters should be set for percentile type",{definition:i,query:e})}}}}async _getQueryEngineResultForStats(e,t,i){e=Object(n.a)(e);try{e=await this._schedule((()=>Object(S.d)(e,this.definitionExpression,this.spatialReference)),i),e=await this._reschedule((()=>this._checkStatisticsSupport(e,t)),i);const s=await this._reschedule((()=>this._executeSceneFilterQuery(e,i)),i),r=await this._reschedule((()=>this._executeGeometryQuery(e,s,i)),i);return await this._reschedule((()=>this._executeAggregateIdsQuery(r)),i),await this._reschedule((()=>this._executeObjectIdsQuery(r)),i),await this._reschedule((()=>this._executeTimeQuery(r)),i),await this._reschedule((()=>this._executeAttributesQuery(r)),i),r}catch(s){if(s!==S.a)throw s;return new x.a([],e,this)}}}const M=Object(u.b)(),Q=Object(u.b)(),E=new Set},619:function(e,t,i){"use strict";function s(e,t){if(!e)return null;const i=t.featureAdapter,{startTimeField:s,endTimeField:r}=e;let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(s&&r)t.forEach((e=>{const t=i.getAttribute(e,s),o=i.getAttribute(e,r);null==t||isNaN(t)||(n=Math.min(n,t)),null==o||isNaN(o)||(a=Math.max(a,o))}));else{const e=s||r;t.forEach((t=>{const s=i.getAttribute(t,e);null==s||isNaN(s)||(n=Math.min(n,s),a=Math.max(a,s))}))}return{start:n,end:a}}function r(e,t,i){if(!t||!e)return null;const{startTimeField:s,endTimeField:r}=e;if(!s&&!r)return null;const{start:n,end:a}=t;return null===n&&null===a?null:void 0===n&&void 0===a?()=>!1:s&&r?function(e,t,i,s,r){return null!=s&&null!=r?n=>{const a=e.getAttribute(n,t),o=e.getAttribute(n,i);return(null==a||a<=r)&&(null==o||o>=s)}:null!=s?t=>{const r=e.getAttribute(t,i);return null==r||r>=s}:null!=r?i=>{const s=e.getAttribute(i,t);return null==s||s<=r}:void 0}(i,s,r,n,a):function(e,t,i,s){return null!=i&&null!=s&&i===s?s=>e.getAttribute(s,t)===i:null!=i&&null!=s?r=>{const n=e.getAttribute(r,t);return n>=i&&n<=s}:null!=i?s=>e.getAttribute(s,t)>=i:null!=s?i=>e.getAttribute(i,t)<=s:void 0}(i,s||r,n,a)}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return r}))},663:function(e,t,i){"use strict";i.d(t,"a",(function(){return S})),i.d(t,"b",(function(){return j})),i.d(t,"c",(function(){return b}));var s=i(145),r=i(477),n=i(247);var a=i(153),o=i(170);function c(e,t){return e?t?4:3:t?3:2}function u(e,t,i,s,r){if(!e)return!1;const n=c(t,i),{coords:a,lengths:o}=e;let u=!1,l=0;for(const c of o)u=h(u,a,n,l,c,s,r),l+=c*n;return u}function h(e,t,i,s,r,n,a){let o=e,c=s;for(let u=s,h=s+r*i;u<h;u+=i){c=u+i,c===h&&(c=s);const e=t[u],r=t[u+1],l=t[c],d=t[c+1];(r<a&&d>=a||d<a&&r>=a)&&e+(a-r)/(d-r)*(l-e)<n&&(o=!o)}return o}var l=i(174),d=i(197),f=i(265),m=i(504);const p="feature-store:unsupported-query",y={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},g={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},_={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},x={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function b(e,t,s,o,h){if(Object(a.g)(t)&&"esriGeometryPoint"===s&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=Object(l.g)(new d.a,t,!1,!1);return Promise.resolve((t=>function(e,t,i,s){return u(e,t,i,s.coords[0],s.coords[1])}(e,!1,!1,t)))}if(Object(a.g)(t)&&"esriGeometryMultipoint"===s){const i=Object(l.g)(new d.a,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>function(e,t,i,s,r,n){const a=c(r,n),{coords:o,lengths:h}=s;if(!h)return!1;for(let c=0,l=0;c<h.length;c++,l+=a)if(!u(e,t,i,o[l],o[l+1]))return!1;return!0}(i,!1,!1,e,o,h)))}if(Object(a.d)(t)&&"esriGeometryPoint"===s&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>Object(r.e)(t,Object(m.c)(s,o,h,e))));if(Object(a.d)(t)&&"esriGeometryMultipoint"===s&&"esriSpatialRelContains"===e)return Promise.resolve((e=>Object(r.d)(t,Object(m.c)(s,o,h,e))));if(Object(a.d)(t)&&"esriSpatialRelIntersects"===e){const e=function(e){return"mesh"===e?n.a:Object(n.b)(e)}(s);return Promise.resolve((i=>e(t,Object(m.c)(s,o,h,i))))}return Promise.all([i.e(5),i.e(12)]).then(i.bind(null,535)).then((i=>{const r=i[y[e]].bind(null,t.spatialReference,t);return e=>r(Object(m.c)(s,o,h,e))}))}async function j(e,t,i){const{spatialRel:r,geometry:n}=e;if(n){if(!0!==g[r])throw new s.a(p,"Unsupported query spatial relationship",{query:e});if(Object(o.l)(n.spatialReference)&&Object(o.l)(i)){if(!function(e){return!0===_[Object(a.c)(e)]}(n))throw new s.a(p,"Unsupported query geometry type",{query:e});if(!function(e){return!0===x[e]}(t))throw new s.a(p,"Unsupported layer geometry type",{query:e});if(e.outSR)return Object(f.a)(e.geometry&&e.geometry.spatialReference,e.outSR)}}}function S(e){if(Object(a.d)(e))return!0;if(Object(a.g)(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}},676:function(e,t,i){"use strict";i.d(t,"a",(function(){return p}));var s=i(145),r=i(208),n=i(143),a=i(134),o=i(402),c=i(165),u=i(174),h=i(1022),l=i(341),d=i(329),f=i(197);const m={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new d.a(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>(Object(a.j)(e.centroid)&&(e.centroid=Object(l.a)(new f.a,e.geometry,t.hasZ,t.hasM)),e.centroid)};class p{constructor(e){this.geometryInfo=e,this._boundsStore=new h.a,this._featuresById=new Map,this._markedIds=new Set,this.events=new r.a,this.featureAdapter=m}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach((t=>{Object(a.k)(t.geometry)&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t,i){for(const s of e){const e=this._boundsStore.get(s.objectId);e&&t(Object(o.h)(i,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}toArray(){return Array.from(this._featuresById.values())}forEach(e){this._featuresById.forEach((t=>e(t)))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,(e=>{t(this._featuresById.get(e))}))}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let e=!1;this._featuresById.forEach(((t,i)=>{this._markedIds.has(i)||(e=!0,this._remove(t))})),this._markedIds.clear(),e&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const t=e.objectId;if(null==t)return void n.a.getLogger("esri.layers.graphics.data.FeatureStore").error(new s.a("featurestore:invalid-feature","feature id is missing",{feature:e}));const i=this._featuresById.get(t);let r;if(this._markedIds.add(t),i?(e.displayId=i.displayId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):Object(a.k)(this.onFeatureAdd)&&this.onFeatureAdd(e),Object(a.j)(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=Object(u.r)(Object(a.k)(r)?r:Object(c.g)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),Object(a.k)(r)&&this._boundsStore.set(t,r),this._featuresById.set(t,e)}_remove(e){return Object(a.k)(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e}}},855:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i(141),r=i(134),n=i(438),a=i(842);class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9,t=arguments.length>1?arguments[1]:void 0;this.compareMinX=l,this.compareMinY=d,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),b.prune(),j.prune(),S.prune(),O.prune()}all(e){this._all(this.data,e)}search(e,t){let i=this.data;const s=this._toBBox;if(_(e,i))for(b.clear();i;){for(let r=0,n=i.children.length;r<n;r++){const n=i.children[r],a=i.leaf?s(n):n;_(e,a)&&(i.leaf?t(n):g(e,a)?this._all(n,t):b.push(n))}i=b.pop()}}collides(e){let t=this.data;const i=this._toBBox;if(!_(e,t))return!1;for(b.clear();t;){for(let s=0,r=t.children.length;s<r;s++){const r=t.children[s],n=t.leaf?i(r):r;if(_(e,n)){if(t.leaf||g(e,n))return!0;b.push(r)}}t=b.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}let t=this._build(e.slice(0,e.length),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=new w([]),this}remove(e){if(!e)return this;let t,i=this.data,n=null,a=0,o=!1;const c=this._toBBox(e);for(S.clear(),O.clear();i||S.length>0;){var u;if(i||(i=Object(r.c)(S.pop()),n=S.data[S.length-1],a=null!==(u=O.pop())&&void 0!==u?u:0,o=!0),i.leaf&&(t=Object(s.f)(i.children,e,i.children.length,i.indexHint),-1!==t))return i.children.splice(t,1),S.push(i),this._condense(S),this;o||i.leaf||!g(i,c)?n?(a++,i=n.children[a],o=!1):i=null:(S.push(i),O.push(a),a=0,n=i,i=i.children[0])}return this}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){let i=e;for(j.clear();i;){var s;if(!0===i.leaf)for(const e of i.children)t(e);else j.pushArray(i.children);i=null!==(s=j.pop())&&void 0!==s?s:null}}_build(e,t,i,s){const r=i-t+1;let n=this._maxEntries;if(r<=n){const s=new w(e.slice(t,i+1));return c(s,this._toBBox),s}s||(s=Math.ceil(Math.log(r)/Math.log(n)),n=Math.ceil(r/n**(s-1)));const a=new R([]);a.height=s;const o=Math.ceil(r/n),u=o*Math.ceil(Math.sqrt(n));x(e,t,i,u,this.compareMinX);for(let c=t;c<=i;c+=u){const t=Math.min(c+u-1,i);x(e,c,t,o,this.compareMinY);for(let i=c;i<=t;i+=o){const r=Math.min(i+o-1,t);a.children.push(this._build(e,i,r,s-1))}}return c(a,this._toBBox),a}_chooseSubtree(e,t,i,s){for(;s.push(t),!0!==t.leaf&&s.length-1!==i;){let i,s=1/0,r=1/0;for(let n=0,a=t.children.length;n<a;n++){const a=t.children[n],o=f(a),c=p(e,a)-o;c<r?(r=c,s=o<s?o:s,i=a):c===r&&o<s&&(s=o,i=a)}t=i||t.children[0]}return t}_insert(e,t,i){const s=this._toBBox,r=i?e:s(e);S.clear();const n=this._chooseSubtree(r,this.data,t,S);for(n.children.push(e),h(n,r);t>=0&&S.data[t].children.length>this._maxEntries;)this._split(S,t),t--;this._adjustParentBBoxes(r,S,t)}_split(e,t){const i=e.data[t],s=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,s);const n=this._chooseSplitIndex(i,r,s);if(!n)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const a=i.children.splice(n,i.children.length-n),o=i.leaf?new w(a):new R(a);o.height=i.height,c(i,this._toBBox),c(o,this._toBBox),t?e.data[t-1].children.push(o):this._splitRoot(i,o)}_splitRoot(e,t){this.data=new R([e,t]),this.data.height=e.height+1,c(this.data,this._toBBox)}_chooseSplitIndex(e,t,i){let s,r,n;s=r=1/0;for(let a=t;a<=i-t;a++){const t=u(e,0,a,this._toBBox),o=u(e,a,i,this._toBBox),c=y(t,o),h=f(t)+f(o);c<s?(s=c,n=a,r=h<r?h:r):c===s&&h<r&&(r=h,n=a)}return n}_chooseSplitAxis(e,t,i){const s=e.leaf?this.compareMinX:l,r=e.leaf?this.compareMinY:d;this._allDistMargin(e,t,i,s)<this._allDistMargin(e,t,i,r)&&e.children.sort(s)}_allDistMargin(e,t,i,s){e.children.sort(s);const r=this._toBBox,n=u(e,0,t,r),a=u(e,i-t,i,r);let o=m(n)+m(a);for(let c=t;c<i-t;c++){const t=e.children[c];h(n,e.leaf?r(t):t),o+=m(n)}for(let c=i-t-1;c>=t;c--){const t=e.children[c];h(a,e.leaf?r(t):t),o+=m(a)}return o}_adjustParentBBoxes(e,t,i){for(let s=i;s>=0;s--)h(t.data[s],e)}_condense(e){for(let t=e.length-1;t>=0;t--){const i=e.data[t];if(0===i.children.length)if(t>0){const r=e.data[t-1],n=r.children;n.splice(Object(s.f)(n,i,n.length,r.indexHint),1)}else this.clear();else c(i,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function c(e,t){u(e,0,e.children.length,t,e)}function u(e,t,i,s,r){r||(r=new w([])),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let n,a=t;a<i;a++)n=e.children[a],h(r,e.leaf?s(n):n);return r}function h(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function l(e,t){return e.minX-t.minX}function d(e,t){return e.minY-t.minY}function f(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function m(e){return e.maxX-e.minX+(e.maxY-e.minY)}function p(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function y(e,t){const i=Math.max(e.minX,t.minX),s=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),n=Math.min(e.maxY,t.maxY);return Math.max(0,r-i)*Math.max(0,n-s)}function g(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function _(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function x(e,t,i,s,n){const o=[t,i];for(;o.length;){const t=Object(r.c)(o.pop()),i=Object(r.c)(o.pop());if(t-i<=s)continue;const c=i+Math.ceil((t-i)/s/2)*s;Object(a.a)(e,c,i,t,n),o.push(i,c,c,t)}}const b=new n.a,j=new n.a,S=new n.a,O=new n.a({deallocator:void 0});class I extends class{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}{constructor(){super(...arguments),this.height=1,this.indexHint=new s.a}}class w extends I{constructor(e){super(),this.children=e,this.leaf=!0}}class R extends I{constructor(e){super(),this.children=e,this.leaf=!1}}}}]);